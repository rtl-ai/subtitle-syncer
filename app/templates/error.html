{% extends "base.html" %}
{% block content %}
  <div class="alert">
    <strong>Processing failed.</strong>
    <p>{{ job.error_message or "The pipeline was unable to complete." }}</p>
  </div>

  {% if job.log_messages %}
    <section class="logs">
      <h3>Logs collected before the error</h3>
      {% for name, entry in job.log_messages.items() %}
        <div class="log-entry">
          <h4>{{ name | upper }}</h4>
          <pre>{{ entry.stdout.strip() or "(no stdout)" }}</pre>
          {% if entry.stderr.strip() %}
            <details>
              <summary>stderr</summary>
              <pre>{{ entry.stderr.strip() }}</pre>
            </details>
          {% endif %}
        </div>
      {% endfor %}
    </section>
  {% endif %}

  {% if job.events %}
    <section class="event-feed">
      <h3>Timeline</h3>
      <ol class="event-feed__list">
        {% for event in job.events %}
          <li class="event-item">
            <div class="event-header">
              <span class="event-time">{{ event.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
              <span class="event-status" data-status="{{ event.status }}">{{ event.status.upper() }}</span>
            </div>
            <div class="event-step">{{ event.current_step }}</div>
            {% if event.message %}
              <p>{{ event.message }}</p>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
    </section>
  {% endif %}

  <p style="margin-top: 2rem;">
    Please review the logs above, adjust your inputs, and try again.
  </p>
  <a class="button" href="/">Back to upload form</a>
{% endblock %}
